@* ======================================================================
   AIMS View: Admin/Index
   ----------------------------------------------------------------------
   Purpose
   - Displays and manages AAD users (add/edit/filter/sort).
   - Uses mock data for front-end UX testing (replace with real DB/Graph calls).

   What’s on this page
   - Users table with role/status filters and sortable Status column.
   - Triggers for Add/Edit User modals (rendered as partials).

   Conventions
   1) Layout
      - Inherits global layout from: ~/Views/Shared/_Layout.cshtml
      - Layout must include Bootstrap CSS and bootstrap.bundle.js.

   2) Styles
      - Page CSS:              ~/css/pages/admin.index.css
      - Component CSS (modals) ~/css/components/_AdminModals.css

   3) Scripts
      - Page JS: ~/js/pages/admin.index.js
      - bootstrap.bundle.js is required for modal behavior.

   4) Partials (rendered below the table wrapper)
      - _AddUserModal, _EditUserModal (Bootstrap + AIMS theming)

   5) Routing
      - Controller: Controllers/Mvc/AdminController.cs
      - Action:     Index()
      - Route:      /Admin or /Admin/Index

   6) Notes
      - Keep DOM IDs stable: addUserModal, editUserModal, addUserForm, editUserForm,
        adminTable, showInactive, roleFilter, aadUserResults.
      - Replace demo `users` array with live data once backend integration is ready.
   ====================================================================== *@

@using AIMS.Utilities
@model List<AIMS.Models.User>
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var users = Model ?? new List<AIMS.Models.User>();
}

@section Styles {
    <link rel="stylesheet" href="~/css/pages/admin.index.css" asp-append-version="true" />
}

<div class="page-title-wrapper mb-3">
  <h2 class="page-title">Admin</h2>
</div>

<div class="table-wrapper">
  <div class="admin-table-controls d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3">
    <div class="d-flex align-items-center gap-2 flex-wrap">
      <button class="btn btn-mint px-4" type="button" data-bs-toggle="modal" data-bs-target="#addUserModal">
        <i class="bi bi-person-plus"></i> Add User
      </button>
      <input
        type="text"
        id="userSearch"
        class="admin-search-pill"
        placeholder="Search Users..."
        oninput="AIMS.Admin.applyAdminTableFilters()"
      />
    </div>

    <div class="d-flex align-items-center gap-3 flex-wrap admin-table-controls-right">
      <label class="toggle-container d-flex align-items-center gap-2 m-0">
        <input type="checkbox" id="showInactive" onchange="AIMS.Admin.toggleInactiveUsers()" />
        <span class="slider"></span>
        Show Inactive Users
      </label>

      <select id="roleFilter" class="aims-select" onchange="AIMS.Admin.filterByRole()">
        <option value="All">All Roles</option>
        <option value="Admin">Admin</option>
        <option value="User">User</option>
      </select>
    </div>
  </div>

<!-- Chrome wrapper: header (fixed) + body (scrolls) -->
<div class="admin-table-wrapper">
  <div class="admin-table-scroll">
    <!-- Header table -->
    <table class="admin-table-header">
      <thead>
        <tr>
          <th class="admin-col-1">Actions</th>
          <th class="admin-col-2">Name</th>
          <th class="admin-col-3">Email</th>
          <th class="admin-col-4">Office</th>
          <th class="admin-col-5" style="cursor:pointer;" onclick="AIMS.Admin.sortTable(4)">Status ⬍</th>
          <th class="admin-col-6">Separation Date</th>
        </tr>
      </thead>
    </table>

    <!-- Body table -->
    <table id="adminTable" class="admin-table-body" data-sort-dir="asc">
      <tbody>
        @foreach (var user in users)
        {
            var statusClass = user.IsArchived ? "inactive" : "active";
            <tr class="user-row @statusClass">
                <td>
                    <button class="icon-btn" title="Edit" onclick="AIMS.Admin.openEditUserModal(this)">
                        <svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true" focusable="false">
                            <path d="M12.146.146a.5.5 0 01.708 0l3 3a.5.5 0 010 .708l-9.793 9.793a.5.5 0 01-.168.11l-5 2a.5.5 0 01-.65-.65l2-5a.5.5 0 01.11-.168L12.146.146zM11.207 2L3 10.207V13h2.793L14 4.793 11.207 2z"></path>
                        </svg>
                    </button>
                 </td>
                <td>@user.FullName</td>
                <td>@user.Email</td>
                <td>@(user.Role?.RoleName ?? "No Role")</td>
                <td><span class="badge @statusClass">@(user.IsArchived ? "Inactive" : "Active")</span></td>
                <td>@(user.IsArchived ? "N/A" : "")</td>
            </tr>
        }
      </tbody>
    </table>
  </div>
</div>
</div>
<!-- Modals -->
@await Html.PartialAsync("_AddUserModal")
@await Html.PartialAsync("_EditUserModal")

@section Scripts {
    <script src="~/js/pages/admin.index.js" asp-append-version="true" defer></script>
}
