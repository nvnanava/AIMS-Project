@* ======================================================================
   AIMS View: AuditLog/Index
   Purpose: Align Audit Log UI with Admin Page baseline and reuse existing Search Logs modal
   ====================================================================== *@

@{
    ViewData["Title"] = "Audit Log";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <!-- bring in the Admin table baseline -->
    <link rel="stylesheet" href="~/css/pages/admin.index.css" asp-append-version="true" />

    <link rel="stylesheet" href="~/css/pages/auditlog.index.css" asp-append-version="true" />
}


<div class="audit-log-container">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="audit-log-title m-0">Audit Log</h1>

        <!-- Filter icon (from Task 4A) -->
        <div class="ms-3">
            @await Html.PartialAsync("_FilterIcon", new ViewDataDictionary(ViewData) {
            ["Id"] = "auditLogFilter",
                        ["Label"] = "Search Logs"
                        })
        </div>
    </div>

    <!-- Admin-style chrome -->
    <div class="table-wrapper">
        <div class="admin-table-chrome">
            <!-- Fixed header -->
            <table class="admin-table-header">
                <thead>
                    <tr>
                        <th>Log ID</th>
                        <th>Timestamp</th>
                        <th>User ID</th>
                        <th>Action</th>
                        <th>Asset ID</th>
                        <th>Previous Value</th>
                        <th>New Value</th>
                        <th>Description</th>
                    </tr>
                </thead>
            </table>

            <!-- Scrollable body -->
            <div class="admin-table-scroll">
                <table class="admin-table-body">
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>2025-04-16 10:12 AM</td>
                            <td>U001</td>
                            <td>Assign</td>
                            <td>A101</td>
                            <td>Unassigned</td>
                            <td>Laptop-001</td>
                            <td>Assigned Laptop to John Smith</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2025-04-16 09:50 AM</td>
                            <td>U002</td>
                            <td>Create</td>
                            <td>A102</td>
                            <td>N/A</td>
                            <td>Monitor-003</td>
                            <td>Created new monitor asset</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>2025-04-15 05:30 PM</td>
                            <td>U003</td>
                            <td>Update</td>
                            <td>A103</td>
                            <td>Monitor-001</td>
                            <td>Monitor-003</td>
                            <td>Updated asset name and status</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>2025-04-15 04:17 PM</td>
                            <td>U001</td>
                            <td>Unassign</td>
                            <td>A104</td>
                            <td>Mouse-002</td>
                            <td>Unassigned</td>
                            <td>Removed asset from user Ava</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>2025-04-15 03:42 PM</td>
                            <td>U004</td>
                            <td>Delete</td>
                            <td>A105</td>
                            <td>Keyboard-001</td>
                            <td>Deleted</td>
                            <td>Deleted broken keyboard asset</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@* Include the existing modal from Task 4A *@
@await Html.PartialAsync("_SearchLogsModal")



@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Target the FilterIcon button from Task 4A
            const root = document.querySelector('[data-component="filter-icon"][data-id="auditLogFilter"]');
            if (!root) return;

            const btn = root.querySelector('.aims-filter-btn');
            const dropdown = root.querySelector('.dropdown-menu');
            if (dropdown) dropdown.remove(); // remove old dropdown menu

            if (btn) {
                btn.removeAttribute('data-bs-toggle');
                btn.removeAttribute('aria-expanded');
                btn.setAttribute('type', 'button');
            }

            const modalEl = document.getElementById('searchLogsModal');
            if (btn && modalEl && window.bootstrap && bootstrap.Modal) {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    bootstrap.Modal.getOrCreateInstance(modalEl).show();
                });
            }
        });
    </script>
}