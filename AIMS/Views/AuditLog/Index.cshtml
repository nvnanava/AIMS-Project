@* ======================================================================
   AIMS View: AuditLog/Index
   ----------------------------------------------------------------------
   Purpose
   - Read-only audit table with client-side filtering (search + action).

   Conventions
   1) Layout
      - Inherits global layout: ~/Views/Shared/_Layout.cshtml

   2) Styles
      - Page CSS: ~/css/pages/auditlog.index.css
      - Component CSS (dropdowns, etc.): ~/css/components/*.css (add as needed)
      - Add page CSS in @section Styles {...} using asp-append-version.

   3) Scripts
      - Page JS: ~/js/pages/auditlog.index.js
      - No inline JS. All event wiring lives in the page script.
      - Add page JS in @section Scripts {...} using asp-append-version.

   4) Routing
      - Controller: Controllers/Mvc/AuditLogController.cs
      - Action:     Index()
      - Route:      /AuditLog or /AuditLog/Index

   5) Notes
      - Indentation: 4 spaces (no tabs)
      - Table body is currently static demo data; replace with server model when ready.
   ====================================================================== *@

@inject Microsoft.Extensions.Configuration.IConfiguration Config

@{
    ViewData["Title"] = "Audit Log";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/pages/auditlog.index.css" asp-append-version="true" />
}

<div class="audit-log-container">
    <h1 class="audit-log-title">Audit Log</h1>

    @* hidden config for JS (polling interval / batch size / feature flags) *@
    <div id="auditlog-config"
         data-poll-interval="@Config["Audit:PollingIntervalMs"]"
         data-max-batch="@Config["Audit:MaxBatchSize"]"
         data-feature-realtime="@Config["Feature:AuditRealTime"]"
         data-feature-polling="@Config["Feature:AuditPollingFallback"]"
         hidden></div>

    <div id="filter-button-container" class="dropdown">
        <button id="filter-button-toggle" class="standard-button" type="button" aria-haspopup="true" aria-expanded="false">
            Filter
        </button>
        <div id="filterDropdown" class="dropdown-menu" role="menu" aria-hidden="true">
            <input type="text" id="filterSearchInput" placeholder="Search logs..." class="dropdown-search" aria-label="Search logs" />
            <a href="#" class="dropdown-item" data-action="All" role="menuitem">All</a>
            <a href="#" class="dropdown-item" data-action="Assign" role="menuitem">Assign</a>
            <a href="#" class="dropdown-item" data-action="Create" role="menuitem">Create</a>
            <a href="#" class="dropdown-item" data-action="Update" role="menuitem">Update</a>
            <a href="#" class="dropdown-item" data-action="Delete" role="menuitem">Delete</a>
            <a href="#" class="dropdown-item" data-action="Unassign" role="menuitem">Unassign</a>
        </div>
    </div>

    <table class="audit-log-table" id="auditTable">
        <thead>
            <tr>
                <th>Log ID</th>
                <th>Timestamp</th>
                <th>User ID</th>
                <th>Action</th>
                <th>Asset ID</th>
                <th>Previous Value</th>
                <th>New Value</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody id="auditTableBody"> @* id for incremental insert/update *@
            @* Demo rows; replace with server-rendered rows or client fetch *@
            <tr>
                <td>1</td>
                <td>2025-04-16 10:12 AM</td>
                <td>U001</td>
                <td>Assign</td>
                <td>A101</td>
                <td>Unassigned</td>
                <td>Laptop-001</td>
                <td>Assigned Laptop to John Smith</td>
            </tr>
            <tr>
                <td>2</td>
                <td>2025-04-16 09:50 AM</td>
                <td>U002</td>
                <td>Create</td>
                <td>A102</td>
                <td>N/A</td>
                <td>Monitor-003</td>
                <td>Created new monitor asset</td>
            </tr>
        </tbody>
    </table>

    @* ---- â¬‡ NEW: Pager (same markup/classes as Search) ------------------ *@
    <div class="search-pager" id="audit-pager" hidden>
        <button type="button" id="audit-pg-prev" class="pager-btn">Prev</button>
        <span id="audit-pg-status" class="pager-status"></span>
        <button type="button" id="audit-pg-next" class="pager-btn">Next</button>
    </div>
    @* -------------------------------------------------------------------- *@
</div>

@section Scripts {
    <script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js" asp-append-version="true"></script>
    <script src="~/js/pages/auditlog.index.js" asp-append-version="true" defer></script>
}