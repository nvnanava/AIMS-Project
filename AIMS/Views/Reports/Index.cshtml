@using AIMS.ViewModels
@* ======================================================================
   AIMS View: Reports/Index
   ----------------------------------------------------------------------
   Purpose
   - Lists generated reports and provides actions: search, CSV download,
     and three “Generate report” modals (Assignment / Office / Custom).

   Conventions
   1) Layout
      - Uses ~/Views/Shared/_Layout.cshtml for Bootstrap/JS includes.

   2) Styles
      - Page CSS: ~/css/pages/reports.index.css
      - Table CSS shared by report tables:
        ~/css/components/_ReportTableComponent.css
      - Do not place inline <style> in this view.

   3) Scripts
      - Page JS: ~/js/pages/reports.index.js (no inline <script>).
      - Uses Bootstrap’s Modal/Toast from the layout bundle.

   4) Markup notes
      - Main table body id: #reports-table-body (unique).
      - Modal table bodies use unique ids:
        #asset-report-tbody, #custom-report-tbody, #user-report-tbody, #office-report-tbody.
      - Avoid duplicate IDs; keep classes semantic.

   5) Data
      - Index loads table data from /api/reports/list.
      - Generate buttons POST to the existing endpoints (as before).

   ====================================================================== *@

@{
  ViewData["Title"] = "Reports";

    // Table headers (server-rendered; values used only for markup)
    var tableHeaders = new List<string> { "Report Name", "Type", "Description", "Office", "Date Created", "Created By" };

    // Demo data for modal tables (left as-is, rendered server-side)
    var userHeaders  = new List<string> { "Name", "Email", "Role", "Asset", "Status" };
    var officeHeaders = new List<string> { "Office", "Asset", "Status" };
    var assetHeaders = new List<string> { "Asset Name", "Type", "Tag #", "Assigned To", "Status" };

}

@section Styles {
    <link rel="stylesheet" href="~/AIMS.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/base/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/components/_ReportTableComponent.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/pages/reports.index.css" asp-append-version="true" />
}

<script>
  window.pageData = {
    // store the User's ID in the window object so that it can easily be called from other functions
    user: "@ViewData["CurrentUserId"]",
    };
</script>


<div class="page-title-wrapper mb-3">
  <h2 class="page-title">Reports</h2>
</div>

<div class="page-wrapper">
  <div class="table-wrapper reports-page">
<div class="reports-page"> @* page-scoped wrapper for bg & spacing *@
    <div class="report-page-size">

<div class="report-management">
  <div class="report-header">
    <div class="left-section">
      <input
        type="text"
        id="reportSearch"
        class="report-search-pill"
        placeholder="Search Reports"
        aria-label="Search Reports"
      />
    </div>

    <!-- Right: Buttons -->
    <div class="d-flex align-items-center gap-2">
        <button type="button" class="btn btn-mint download-csv-button">
            Download CSV
        </button>
        <div class="dropdown">
            <button class="btn btn-mint dropdown-toggle" type="button" id="newReportDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-plus-circle"></i> New Report
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="newReportDropdown">
                <li><button class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#generateAssignmentReport">Assignment Report</button></li>
                <li><button class="dropdown-item" type="button" data-bs-toggle="modal"
                    data-bs-target="#generateOfficeReport">Office Report</button></li>
                <li><button class="dropdown-item" type="button" data-bs-toggle="modal"
                    data-bs-target="#generateCustomReport">Custom Report</button></li>
            </ul>
        </div>
    </div>
</div>
</div>
</div>

   <div class="table-container table-responsive">
  <table class="table aims-table report-table">
    <thead>
      <tr>
        <th scope="col"><span class="sort-text"></span></th>
        @foreach (var header in tableHeaders)
        {
          <th scope="col"><span class="sort-text">@header</span></th>
        }
      </tr>
    </thead>
    <tbody id="reports-table-body">
      <tr>
        <td colspan="@tableHeaders.Count + 1" class="no-results-cell">Loading...</td>
      </tr>
    </tbody>
  </table>
</div>

</div> <!-- .report-management -->
</div> <!-- .report-page-size -->

<div class="report-toast-container">
  <div id="reportToast" class="toast report-toast" role="alert" data-bs-autohide="true">
    <div class="d-flex">
      <div class="toast-body">Report generated!</div>
    </div>
  </div>
</div>

</div> <!-- .table-wrapper -->
</div> <!-- .page-wrapper -->

@* ------------------------- Modals ------------------------- *@

<!-- Generate Assignment Report Modal -->
<div class="modal fade" id="generateAssignmentReport" tabindex="-1" aria-labelledby="generateAssignmentReportLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="generateAssignmentReportLabel">Generate an Assignment Report</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form class="row g-3" id="assignmentReportForm">
          <div class="col-12">
            <label for="reportName" class="form-label">Report Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="reportName" name="reportName" required />
          </div>

          <div class="col-md-6">
            <label for="dateRange1" class="form-label">Start Date <span class="text-danger">*</span></label>
            <input type="date" class="form-control" id="dateRange1" name="dateRange1" required />
          </div>

          <div class="col-md-6">
            <label for="dateRange2" class="form-label">End Date (optional)</label>
            <input type="date" class="form-control" id="dateRange2" name="dateRange2" />
          </div>

          <div class="col-12">
            <label for="inputDescription" class="form-label">Description (optional)</label>
            <input type="text" class="form-control" id="inputDescription" />
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-gray" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-mint" id="generateAssignmentReportBtn">Generate Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Generate Office Report Modal -->
<div class="modal fade" id="generateOfficeReport" tabindex="-1" aria-labelledby="generateOfficeReportLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="generateOfficeReportLabel">Generate an Office Report</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form class="row g-3" id="officeReportForm">
          <div class="col-12">
            <label for="officeReportName" class="form-label">Report Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="officeReportName" name="officeReportName" required />
          </div>

          <div class="col-12">
            <label for="officeName" class="form-label">Office Name <span class="text-danger">*</span></label>
               <select id="officeName" name="officeName" class="form-select" required>
                            <option value="">Select Office</option>
                            
                           @* Populate offices, using names as display values and IDs as actual values  *@
                          @{ var offices = ViewData["Offices"] as List<OfficeVm> ?? new List<OfficeVm>(); }
                          @foreach (var office in offices) { 
                            <option value="@office.OfficeID">@office.OfficeName</option>
                          }
                        </select>
              
          </div>

          <div class="col-md-6">
            <label for="officeStartDate" class="form-label">Start Date <span class="text-danger">*</span></label>
            <input type="date" class="form-control" id="officeStartDate" name="officeStartDate" required />
          </div>

          <div class="col-md-6">
            <label for="officeEndDate" class="form-label">End Date (optional)</label>
            <input type="date" class="form-control" id="officeEndDate" name="officeEndDate" />
          </div>

          <div class="col-12">
            <label for="officeDescription" class="form-label">Description (optional)</label>
            <input type="text" class="form-control" id="officeDescription" />
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-gray" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-mint" id="generateOfficeReportBtn">Generate Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Generate Custom Report Modal -->
<div class="modal fade" id="generateCustomReport" tabindex="-1" aria-labelledby="generateCustomReportLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="generateCustomReportLabel">Generate a Custom Report</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form class="row g-3" id="customReportForm">
          <div class="col-12">
            <label for="customReportName" class="form-label">Report Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="customReportName" name="customReportName" required />
          </div>

          <div class="col-md-6">
            <label for="customStartDate" class="form-label">Start Date <span class="text-danger">*</span></label>
            <input type="date" class="form-control" id="customStartDate" name="customStartDate" required />
          </div>

          <div class="col-md-6">
            <label for="customEndDate" class="form-label">End Date (optional)</label>
            <input type="date" class="form-control" id="customEndDate" name="customEndDate" />
          </div>

          <div class="col-12">
            <label for="customDescription" class="form-label">Description (optional)</label>
            <input type="text" class="form-control" id="customDescription" />
          </div>

          <div class="col-12">
            <div class="form-check">
              <input type="checkbox" class="aims-checkbox" id="seeHardware" checked />
              <label class="form-check-label" for="seeHardware">See Hardware</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="aims-checkbox" id="seeSoftware" checked />
              <label class="form-check-label" for="seeSoftware">See Software</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="aims-checkbox" id="seeUsers" checked />
              <label class="form-check-label" for="seeUsers">See Users</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="aims-checkbox" id="seeOffice" checked />
              <label class="form-check-label" for="seeOffice">See Office</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="aims-checkbox" id="seeExpiration" />
              <label class="form-check-label" for="seeExpiration">See when software and/or warranty expires</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="aims-checkbox" id="filterByMaintenance" />
              <label class="form-check-label" for="filterByMaintenance">See what requires maintenance or replacements</label>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-gray" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-mint" id="generateCustomReportBtn">Generate Report</button>
      </div>
    </div>
  </div>
</div>

@* ---- Static modal tables (demo content) -------------------------------- *@

<!-- Asset Report Modal (table) -->
<div class="modal fade" id="assetReportModal" tabindex="-1" aria-labelledby="assetReportModalLabel" aria-hidden="true">
  <div class="modal-dialog custom-width">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="assetReportModalLabel">Asset Report</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="table-container table-responsive">
          <table class="table aims-table other-table">
            <thead>
              <tr>
                @foreach (var header in assetHeaders)
                {
                  <th scope="col"><span class="sort-text">@header</span></th>
                }
              </tr>
            </thead>

            <tbody id="asset-report-tbody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom Report Modal (table) -->
<div class="modal fade" id="customReportModalView" tabindex="-1" aria-labelledby="customReportModalViewLabel" aria-hidden="true">
  <div class="modal-dialog custom-width">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="customReportModalViewLabel">Custom Report</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="table-container table-responsive">
          <table class="table aims-table other-table">
            <thead>
              <tr>
                @foreach (var header in assetHeaders)
                {
                  <th scope="col"><span class="sort-text">@header</span></th>
                }
              </tr>
            </thead>

            <tbody id="custom-report-tbody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Asset Assignments to Users Modal (table) -->
<div class="modal fade" id="assetAssignmentsToUsersModal" tabindex="-1" aria-labelledby="assetAssignmentsToUsersModalLabel" aria-hidden="true">
  <div class="modal-dialog custom-width">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="assetAssignmentsToUsersModalLabel">Asset Assignments to Users</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="table-container table-responsive">
          <table class="table aims-table other-table">
            <thead>
              <tr>
                @foreach (var header in userHeaders)
                {
                  <th scope="col"><span class="sort-text">@header</span></th>
                }
              </tr>
            </thead>

            <tbody id="user-report-tbody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Assets Assigned to an Office Modal (table) -->
<div class="modal fade" id="assetsAssignedToOfficeModal" tabindex="-1" aria-labelledby="assetsAssignedToOfficeModalLabel" aria-hidden="true">
  <div class="modal-dialog custom-width-two">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="assetsAssignedToOfficeModalLabel">Assets Assigned to an Office</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="table-container table-responsive">
          <table class="table aims-table other-table">
            <thead>
              <tr>
                @foreach (var header in officeHeaders)
                {
                  <th scope="col"><span class="sort-text">@header</span></th>
                }
              </tr>
            </thead>

            <tbody id="office-report-tbody">
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Dynamic Report Preview Modal -->
<div class="modal fade" id="reportPreviewModal" tabindex="-1" aria-labelledby="reportPreviewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reportPreviewModalLabel">Report Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body" id="reportPreviewContent">
        <div class="text-center text-muted p-4">
          Select a report to preview
        </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {
  <script src="~/js/pages/reports.index.js" asp-append-version="true" defer></script>
}

